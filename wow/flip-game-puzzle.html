<html>
<head>
    <style>
.row {
    display: flex;
    flex-direction: row;
}
.node-toggled {
    width: 50px;
    height: 50px;
    border-style: solid;
    border-color: dodgerblue;
    background-color: floralwhite;
}
.node {
    width: 50px;
    height: 50px;
    border-style: solid;
    border-color: dodgerblue;
    background-color: grey;
}
.ans-toggled {
    width: 50px;
    height: 50px;
    border-style: solid;
    border-color: dodgerblue;
    background-color: greenyellow;
}
.ans {
    width: 50px;
    height: 50px;
    border-style: solid;
    border-color: dodgerblue;
    background-color: grey;
}
    </style>
    <script>
"use strict";

const js = function() {
    const createArray = function(n) {
        const array = new Array(n);
        for (let i = 0; i < n; i++) {
            array[i] = new Array(n);
            for (let j = 0; j < n; j++) {
                array[i][j] = 0;
            }
        }

        return array;
    }

    const n = 5;
    const values = createArray(n);

    const onLoad = function() {
        const holder = document.getElementById("holder");
        for (let i = 0; i < n; i++) {
            let row = document.createElement("div");
            row.className = "row";
            holder.appendChild(row);
            for (let j = 0; j < n; j++) {
                let node = document.createElement("div");
                node.className = "node";
                row.appendChild(node);

                node.addEventListener("click", function() {
                    values[i][j] ^= 1;
                    node.className = values[i][j] ? "node-toggled" : "node";
                });
            }
        }
    }

    const calc = function(i, j, ans) {
        var val = values[i][j] ^ ans[i][j];

        if (i > 0) {
            val ^= ans[i - 1][j];
        }
        if (j > 0) {
            val ^= ans[i][j - 1];
        }
        if (j < n - 1) {
            val ^= ans[i][j + 1];
        }
        return val;
    }

    const calcFlip = function(ans) {
        var flips = 0;
        for (let i = 0; i < n; i++) {
            for( let j = 0; j < n; j++) {
                flips += ans[i][j];
            }
        }
        return flips;
    }

    const solveImpl = function() {
        const ansArray = [];
        for (let mask = 0; mask < (1<<n); mask++) {
            const ans = createArray(n);

            for (let j = 0; j < n; j++) {
                ans[0][j] = (mask>>j)&1;
            }
            for (let i = 1; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const val = calc(i - 1, j, ans);
                    ans[i][j] = val;
                }
            }

            var isAns = true;
            for (let j = 0; j < n && isAns; j++) {
                const val = calc(n - 1, j, ans);
                isAns = val == 0;
            }

            if (isAns) {
                ansArray.push({
                    flips: calcFlip(ans),
                    array: ans,
                });
            }
        }
        
        return ansArray;
    }

    const appendAns = function(index, ans) {
        const text = document.createTextNode("Answer #" +  index + " with " + ans.flips + " flips:");
        const answer = document.createElement("div");
        document.getElementById("answers").appendChild(text);
        document.getElementById("answers").appendChild(answer);

        for (let i = 0; i < n; i++) {
            let row = document.createElement("div");
            row.className = "row";
            answer.appendChild(row);
            for (let j = 0; j < n; j++) {
                let node = document.createElement("div");
                node.className = ans.array[i][j] ? "ans-toggled" : "ans";
                row.appendChild(node);
            }
        }
    }

    const solve = function() {
        const ansArray = solveImpl();

        const answers = document.getElementById("answers");
        answers.innerHTML = "";
        
        if (ansArray.length == 0) {
            const text = document.createTextNode("No answer.");
            answers.appendChild(text);
            return;
        }

        ansArray.sort((a, b) => {
            return a.flips - b.flips;
        });

        for (let i = 0; i < ansArray.length; i++) {
            appendAns(i + 1, ansArray[i]);
        }
    }

    return {
        onLoad: onLoad,
        solve: solve,
    }
} ();

    </script>
</head>

<body onload="js.onLoad()">
    <div id="holder"></div>
    <div id="button">
        <button onclick="js.solve()">Solve</button>
    </div>
    <div id="answers"></div>
</body>
</html>
